name: 🛡️ CI Audit

on:
  pull_request:
  push:
    branches: [main, develop]

jobs:
  audit:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # 1️⃣  Install PNPM first
      - name: 🟣 Set up PNPM
        uses: pnpm/action-setup@v4
        with:
          run_install: true        # or true
          standalone: true
      
      # 2️⃣  Set up Node (pnpm now in PATH, cache restore safe)
      - name: 🔧 Set up Node 20
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm

      # 3️⃣  Lint / type-check / unit tests
      - name: 🔍 Lint, type-check, tests
        run: pnpm run ci
